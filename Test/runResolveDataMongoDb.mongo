// 2.ครัวเรือนทั้งหมด -> IsHouseHold (do)
db.NewDataProcessDebug.updateMany(
  {
    SampleType: "u",
    IsHouseHold: 0,
    CountPopulation: { $gt: 0 },
  },
  {
    $set: {
      CountPopulation: 0,
    },
  }
);

//16.ระดับความลึกของน้ำท่วม (ในเขตที่อยู่อาศัย) -> AvgWaterHeightCm
//17.ระยะเวลาที่น้ำท่วมขัง (ในเขตที่อยู่อาศัย) -> TimeWaterHeightCm
db.NewDataProcessDebug.updateMany([
  {
    $or: [{ AvgWaterHeightCm: 0 }, { TimeWaterHeightCm: 0 }],
  },
  {
    $set: {
      AvgWaterHeightCm: 0,
      TimeWaterHeightCm: 0,
    },
  }
]);

//23.แหล่งน้ำขนาดใหญ่ กลาง และเล็ก (สน.2) -> WaterSources (do) -> 
db.NewDataProcessDebug.updateMany([
  {
    SampleType : "c",
    WaterSources : {$lt : 1260}
  },
  {
    $set: {
      WaterSources: 0
    },
  }
]);

// create result data EA
db.NewDataProcessDebug.aggregate(
  [
    {
      $group: {
        _id: "$EA",
        IsAgriculture: {
          $sum: "$IsAgriculture",
        },
        IsHouseHold: {
          $sum: "$IsHouseHold",
        },
        IsHouseHoldGoodPlumbing: {
          $sum: "$IsHouseHoldGoodPlumbing",
        },
        IsAgricultureHasIrrigationField: {
          $sum: "$IsAgricultureHasIrrigationField",
        },
        IsHouseHoldHasPlumbingDistrict: {
          $sum: "$IsHouseHoldHasPlumbingDistrict",
        },
        IsHouseHoldHasPlumbingCountryside: {
          $sum: "$IsHouseHoldHasPlumbingCountryside",
        },
        IsFactorialWaterQuality: {
          $sum: "$IsFactorialWaterQuality",
        },
        IsCommercialWaterQuality: {
          $sum: "$IsCommercialWaterQuality",
        },
        CountPopulation: {
          $sum: "$CountPopulation",
        },
        CountWorkingAge: {
          $sum: "$CountWorkingAge",
        },
        IsFactorial: {
          $sum: "$IsFactorial",
        },
        IsFactorialWaterTreatment: {
          $sum: "$IsFactorialWaterTreatment",
        },
        IsCommunityWaterManagementHasWaterTreatment: {
          $sum: "$IsCommunityWaterManagementHasWaterTreatment",
        },
        FieldCommunity: {
          $sum: "$FieldCommunity",
        },
        AvgWaterHeightCm: {
          $avg: "$AvgWaterHeightCm",
        },
        TimeWaterHeightCm: {
          $avg: "$TimeWaterHeightCm",
        },
        HasntPlumbing: {
          $avg: "$HasntPlumbing",
        },
        IsGovernment: {
          $sum: "$IsGovernment",
        },
        IsGovernmentUsage: {
          $sum: "$IsGovernmentUsage",
        },
        IsGovernmentWaterQuality: {
          $sum: "$IsGovernmentWaterQuality",
        },
        CommunityNatureDisaster: {
          $sum: "$CommunityNatureDisaster",
        },
        IndustryHasWasteWaterTreatment: {
          $sum: "$IndustryHasWasteWaterTreatment",
        },
        PeopleInFloodedArea: {
          $sum: "$PeopleInFloodedArea",
        },
        CountCommunity: {
          $sum: "$CountCommunity",
        },
        CountCommunityHasDisaster: {
          $sum: "$CountCommunityHasDisaster",
        },
        IsAllHouseHoldCountryside: {
          $sum: "$IsAllHouseHoldCountryside",
        },
        IsAllHouseHoldDistrict: {
          $sum: "$IsAllHouseHoldDistrict",
        },
        IsAllFactorial: {
          $sum: "$IsAllFactorial",
        },
        IsAllCommercial: {
          $sum: "$IsAllCommercial",
        },
      },
    },
    {
      $project: {
        IsAgriculture: 1,
        IsHouseHold: 1,
        IsHouseHoldGoodPlumbing: 1,
        IsAgricultureHasIrrigationField: 1,
        IsHouseHoldHasPlumbingDistrict: 1,
        IsHouseHoldHasPlumbingCountryside: 1,
        IsFactorialWaterQuality: 1,
        IsCommercialWaterQuality: 1,
        CountPopulation: 1,
        CountWorkingAge: 1,
        IsFactorial: 1,
        IsFactorialWaterTreatment: 1,
        IsCommunityWaterManagementHasWaterTreatment: 1,
        FieldCommunity: 1,
        AvgWaterHeightCm: 1,
        TimeWaterHeightCm: 1,
        HasntPlumbing: 1,
        IsGovernment: 1,
        IsGovernmentUsage: 1,
        IsGovernmentWaterQuality: 1,
        CommunityNatureDisaster: 1,
        IndustryHasWasteWaterTreatment: 1,
        PeopleInFloodedArea: 1,
        CountCommunity: 1,
        CountCommunityHasDisaster: 1,
        IsAllHouseHoldCountryside: 1,
        IsAllHouseHoldDistrict: 1,
        IsAllFactorial: 1,
        IsAllCommercial: 1,
        CountGroundWaterUnit: {
          $toInt: 0,
        },
        CountGroundWaterCom: {
          $toInt: 0,
        },
        WaterSourcesUnit: {
          $toInt: 0,
        },
        WaterSourcesCom: {
          $toInt: 0,
        },
      },
    },
    {
      $out: "ResultNewDataEABKK",
    },
  ],
  {
    allowDiskUse: true,
  }
);

// add field ResultNewDataEA
db.ResultNewDataEABKK.aggregate(
  [
    {
      $lookup: {
        from: "ea",
        localField: "_id",
        foreignField: "_id",
        as: "dataEAInfo",
      },
    },
    {
      $unwind: {
        path: "$dataEAInfo",
        preserveNullAndEmptyArrays: true,
      },
    },
    {
      $project: {
        REG: {
          $ifNull: ["$dataEAInfo.REG", ""],
        },
        REG_NAME: {
          $ifNull: ["$dataEAInfo.REG_NAME", ""],
        },
        CWT: {
          $ifNull: ["$dataEAInfo.CWT", ""],
        },
        CWT_NAME: {
          $ifNull: ["$dataEAInfo.CWT_NAME", ""],
        },
        AMP: {
          $ifNull: ["$dataEAInfo.AMP", ""],
        },
        AMP_NAME: {
          $ifNull: ["$dataEAInfo.AMP_NAME", ""],
        },
        TAM: {
          $ifNull: ["$dataEAInfo.TAM", ""],
        },
        TAM_NAME: {
          $ifNull: ["$dataEAInfo.TAM_NAME", ""],
        },
        MUN: {
          $ifNull: ["$dataEAInfo.MUN", ""],
        },
        MUN_NAME: {
          $ifNull: ["$dataEAInfo.MUN_NAME", ""],
        },
        TAO: {
          $ifNull: ["$dataEAInfo.TAO", ""],
        },
        TAO_NAME: {
          $ifNull: ["$dataEAInfo.TAO_NAME", ""],
        },
        VIL: {
          $ifNull: ["$dataEAInfo.VIL", ""],
        },
        VIL_NAME: {
          $ifNull: ["$dataEAInfo.VIL_NAME", ""],
        },
        IsAgriculture: 1,
        IsHouseHold: 1,
        IsHouseHoldGoodPlumbing: 1,
        IsAgricultureHasIrrigationField: 1,
        IsHouseHoldHasPlumbingDistrict: 1,
        IsHouseHoldHasPlumbingCountryside: 1,
        IsFactorialWaterQuality: 1,
        IsCommercialWaterQuality: 1,
        CountPopulation: 1,
        CountWorkingAge: 1,
        IsFactorial: 1,
        IsFactorialWaterTreatment: 1,
        IsCommunityWaterManagementHasWaterTreatment: 1,
        FieldCommunity: 1,
        AvgWaterHeightCm: 1,
        TimeWaterHeightCm: 1,
        HasntPlumbing: 1,
        IsGovernment: 1,
        IsGovernmentUsage: 1,
        IsGovernmentWaterQuality: 1,
        CommunityNatureDisaster: 1,
        IndustryHasWasteWaterTreatment: 1,
        PeopleInFloodedArea: 1,
        CountCommunity: 1,
        CountCommunityHasDisaster: 1,
        IsAllHouseHoldCountryside: 1,
        IsAllHouseHoldDistrict: 1,
        IsAllFactorial: 1,
        IsAllCommercial: 1,
        CountGroundWaterUnit: 1,
        CountGroundWaterCom: 1,
        WaterSourcesUnit: 1,
        WaterSourcesCom: 1,
      },
    },
    {
      $out: "ResultNewDataEABKKClean",
    },
  ],
  {
    allowDiskUse: true,
  }
);

// create result data areacode
db.NewDataProcessDebug.aggregate([
  {
    $group: {
      _id: "$Area_Code",
      CubicMeterGroundWaterForAgriculture: {
        $sum: "$CubicMeterGroundWaterForAgriculture",
      },
      CubicMeterGroundWaterForService: {
        $sum: "$CubicMeterGroundWaterForService",
      },
      CubicMeterGroundWaterForProduct: {
        $sum: "$CubicMeterGroundWaterForProduct",
      },
      CubicMeterGroundWaterForDrink: {
        $sum: "$CubicMeterGroundWaterForDrink",
      },
      CubicMeterPlumbingForAgriculture: {
        $sum: "$CubicMeterPlumbingForAgriculture",
      },
      CubicMeterPlumbingForService: {
        $sum: "$CubicMeterPlumbingForService",
      },
      CubicMeterPlumbingForProduct: {
        $sum: "$CubicMeterPlumbingForProduct",
      },
      CubicMeterPlumbingForDrink: {
        $sum: "$CubicMeterPlumbingForDrink",
      },
      CubicMeterSurfaceForAgriculture: {
        $sum: "$CubicMeterSurfaceForAgriculture",
      },
      CubicMeterSurfaceForService: {
        $sum: "$CubicMeterSurfaceForService",
      },
      CubicMeterSurfaceForProduct: {
        $sum: "$CubicMeterSurfaceForProduct",
      },
      CubicMeterSurfaceForDrink: {
        $sum: "$CubicMeterSurfaceForDrink",
      },
      CubicMeterGroundWaterForUse: {
        $sum: "$CubicMeterGroundWaterForUse",
      },
    },
  },
  {
    $project: {
      CubicMeterGroundWaterForAgriculture: 1,
      CubicMeterGroundWaterForService: 1,
      CubicMeterGroundWaterForProduct: 1,
      CubicMeterGroundWaterForDrink: 1,
      CubicMeterPlumbingForAgriculture: 1,
      CubicMeterPlumbingForService: 1,
      CubicMeterPlumbingForProduct: 1,
      CubicMeterPlumbingForDrink: 1,
      CubicMeterSurfaceForAgriculture: 1,
      CubicMeterSurfaceForService: 1,
      CubicMeterSurfaceForProduct: 1,
      CubicMeterSurfaceForDrink: 1,
      CubicMeterGroundWaterForUse: 1,
      CountGroundWaterUnit: {
        $toInt: 0,
      },
      CountGroundWaterCom: {
        $toInt: 0,
      },
      WaterSourcesUnit: {
        $toInt: 0,
      },
      WaterSourcesCom: {
        $toInt: 0,
      },
    },
  },
  { $out: "ResultNewDataAreaCodeBKK" }
]);

// add field ResultNewDataAreaCode
db.ResultNewDataAreaCodeBKK.aggregate(
  [
    {
      $lookup: {
        from: "ea",
        localField: "_id",
        foreignField: "Area_Code",
        as: "dataEAInfo",
      },
    },
    {
      $unwind: {
        path: "$dataEAInfo",
        preserveNullAndEmptyArrays: true,
      },
    },
    {
      $project: {
        REG: {
          $ifNull: ["$dataEAInfo.REG", ""],
        },
        REG_NAME: {
          $ifNull: ["$dataEAInfo.REG_NAME", ""],
        },
        CWT: {
          $ifNull: ["$dataEAInfo.CWT", ""],
        },
        CWT_NAME: {
          $ifNull: ["$dataEAInfo.CWT_NAME", ""],
        },
        AMP: {
          $ifNull: ["$dataEAInfo.AMP", ""],
        },
        AMP_NAME: {
          $ifNull: ["$dataEAInfo.AMP_NAME", ""],
        },
        TAM: {
          $ifNull: ["$dataEAInfo.TAM", ""],
        },
        TAM_NAME: {
          $ifNull: ["$dataEAInfo.TAM_NAME", ""],
        },
        CubicMeterGroundWaterForAgriculture: 1,
        CubicMeterGroundWaterForService: 1,
        CubicMeterGroundWaterForProduct: 1,
        CubicMeterGroundWaterForDrink: 1,
        CubicMeterPlumbingForAgriculture: 1,
        CubicMeterPlumbingForService: 1,
        CubicMeterPlumbingForProduct: 1,
        CubicMeterPlumbingForDrink: 1,
        CubicMeterSurfaceForAgriculture: 1,
        CubicMeterSurfaceForService: 1,
        CubicMeterSurfaceForProduct: 1,
        CubicMeterSurfaceForDrink: 1,
        CubicMeterGroundWaterForUse: 1,
        CountGroundWaterUnit: 1,
        CountGroundWaterCom: 1,
        WaterSourcesUnit: 1,
        WaterSourcesCom: 1,
      },
    },
    {
      $out: "ResultNewDataAreaCodeBKKClean",
    },
  ],
  {
    allowDiskUse: true,
  }
);

// add field EaInfo
db.NewDataProcessBKK.aggregate(
  [
    {
      $lookup: {
        from: "ea",
        localField: "EA",
        foreignField: "_id",
        as: "dataEAInfo",
      },
    },
    {
      $unwind: {
        path: "$dataEAInfo",
        preserveNullAndEmptyArrays: true,
      },
    },
    {
      $project: {
        SampleId: 1,
        SampleType: 1,
        EA: 1,
        Area_Code: 1,
        REG: {
          $ifNull: ["$dataEAInfo.REG", ""],
        },
        REG_NAME: {
          $ifNull: ["$dataEAInfo.REG_NAME", ""],
        },
        CWT: {
          $ifNull: ["$dataEAInfo.CWT", ""],
        },
        CWT_NAME: {
          $ifNull: ["$dataEAInfo.CWT_NAME", ""],
        },
        AMP: {
          $ifNull: ["$dataEAInfo.AMP", ""],
        },
        AMP_NAME: {
          $ifNull: ["$dataEAInfo.AMP_NAME", ""],
        },
        TAM: {
          $ifNull: ["$dataEAInfo.TAM", ""],
        },
        TAM_NAME: {
          $ifNull: ["$dataEAInfo.TAM_NAME", ""],
        },
        Status: 1,
        Count: 1,
        CubicMeterPerMonth: 1,
        WaterBill: 1,
        PumpCount: 1,
        PumpAuto: 1,
        TurbidWater: 1,
        SaltWater: 1,
        Smell: 1,
        FilmOfOil: 1,
        FogWater: 1,
        HardWater: 1,
        Agriculture: 1,
        Service: 1,
        Product: 1,
        Drink: 1,
        Plant: 1,
        Farm: 1,
        DoingMWA: 1,
        CubicMeterPerMonthMWA: 1,
        WaterBillMWA: 1,
        TurbidWaterMWA: 1,
        SaltWaterMWA: 1,
        SmellMWA: 1,
        FilmOfOilMWA: 1,
        FogWaterMWA: 1,
        HardWaterMWA: 1,
        AgricultureMWA: 1,
        ServiceMWA: 1,
        ProductMWA: 1,
        DrinkMWA: 1,
        PlantMWA: 1,
        DoingPWA: 1,
        CubicMeterPerMonthPWA: 1,
        WaterBillPWA: 1,
        TurbidWaterPWA: 1,
        SaltWaterPWA: 1,
        SmellPWA: 1,
        FilmOfOilPWA: 1,
        FogWaterPWA: 1,
        HardWaterPWA: 1,
        AgriculturePWA: 1,
        ServicePWA: 1,
        ProductPWA: 1,
        DrinkPWA: 1,
        PlantPWA: 1,
        DoingOther: 1,
        CubicMeterPerMonthOther: 1,
        WaterBillOther: 1,
        TurbidWaterOther: 1,
        SaltWaterOther: 1,
        SmellOther: 1,
        FilmOfOilOther: 1,
        FogWaterOther: 1,
        HardWaterOther: 1,
        AgricultureOther: 1,
        ServiceOther: 1,
        ProductOther: 1,
        DrinkOther: 1,
        PlantOther: 1,
        MeterRentalFee: 1,
        PlumbingPrice: 1,
        PoolCount: 1,
        WaterResourceCount: 1,
        CubicMeterPerMonthPool: 1,
        PumpCountPool: 1,
        PumpAutoPool: 1,
        SaltWaterPool: 1,
        SmellPool: 1,
        FilmOfOilPool: 1,
        FogWaterPool: 1,
        AgriculturePool: 1,
        ServicePool: 1,
        ProductPool: 1,
        DrinkPool: 1,
        PlantPool: 1,
        FarmPool: 1,
        CubicMeterPerMonthIrrigation: 1,
        PumpCountIrrigation: 1,
        PumpAutoIrrigation: 1,
        SaltWaterIrrigation: 1,
        SmellIrrigation: 1,
        FilmOfOilIrrigation: 1,
        FogWaterIrrigation: 1,
        AgricultureIrrigation: 1,
        ServiceIrrigation: 1,
        ProductIrrigation: 1,
        DrinkIrrigation: 1,
        PlantIrrigation: 1,
        FarmIrrigation: 1,
        PumpCountRiver: 1,
        PumpAutoRiver: 1,
        SaltWaterRiver: 1,
        SmellRiver: 1,
        FilmOfOilRiver: 1,
        FogWaterRiver: 1,
        AgricultureRiver: 1,
        ServiceRiver: 1,
        ProductRiver: 1,
        DrinkRiver: 1,
        PlantRiver: 1,
        FarmRiver: 1,
        AgricultureRain: 1,
        ServiceRain: 1,
        ProductRain: 1,
        DrinkRain: 1,
        PlantRain: 1,
        CanComputeCubicMeterGroundWaterForAgriculture: 1,
        CanComputeCubicMeterGroundWaterForService: 1,
        CanComputeCubicMeterGroundWaterForProduct: 1,
        CanComputeCubicMeterGroundWaterForDrink: 1,
        CanComputeCubicMeterPlumbingForAgriculture: 1,
        CanComputeCubicMeterPlumbingForService: 1,
        CanComputeCubicMeterPlumbingForProduct: 1,
        CanComputeCubicMeterPlumbingForDrink: 1,
        CanComputeCubicMeterSurfaceForAgriculture: 1,
        CanComputeCubicMeterSurfaceForService: 1,
        CanComputeCubicMeterSurfaceForProduct: 1,
        CanComputeCubicMeterSurfaceForDrink: 1,
        CanComputeCubicMeterGroundWaterForUse: 1,
        CanComputeCubicMeterForDrink: 1,
        IsAgriculture: 1,
        IsHouseHold: 1,
        IsHouseHoldGoodPlumbing: 1,
        IsAgricultureHasIrrigationField: 1,
        IsHouseHoldHasPlumbingDistrict: 1,
        IsHouseHoldHasPlumbingCountryside: 1,
        IsFactorialWaterQuality: 1,
        IsCommercialWaterQuality: 1,
        CountGroundWater: 1,
        CountPopulation: 1,
        CountWorkingAge: 1,
        IsFactorial: 1,
        IsFactorialWaterTreatment: 1,
        IsCommunityWaterManagementHasWaterTreatment: 1,
        FieldCommunity: 1,
        AvgWaterHeightCm: 1,
        TimeWaterHeightCm: 1,
        HasntPlumbing: 1,
        IsGovernment: 1,
        IsGovernmentUsage: 1,
        IsGovernmentWaterQuality: 1,
        CommunityNatureDisaster: 1,
        WaterSources: 1,
        IndustryHasWasteWaterTreatment: 1,
        PeopleInFloodedArea: 1,
        CubicMeterGroundWaterForAgricultureGroundWater: 1,
        CubicMeterGroundWaterForAgricultureBuying: 1,
        CubicMeterGroundWaterForAgriculture: 1,
        CubicMeterGroundWaterForServiceGroundWater: 1,
        CubicMeterGroundWaterForServiceBuying: 1,
        CubicMeterGroundWaterForService: 1,
        CubicMeterGroundWaterForProductGroundWater: 1,
        CubicMeterGroundWaterForProductBuying: 1,
        CubicMeterGroundWaterForProduct: 1,
        CubicMeterGroundWaterForDrinkGroundWater: 1,
        CubicMeterGroundWaterForDrinkBuying: 1,
        CubicMeterGroundWaterForDrink: 1,
        CubicMeterPlumbingForAgricultureMWA: 1,
        CubicMeterPlumbingForAgriculturePWA: 1,
        CubicMeterPlumbingForAgricultureOther: 1,
        CubicMeterPlumbingForAgriculture: 1,
        CubicMeterPlumbingForServiceMWA: 1,
        CubicMeterPlumbingForServicePWA: 1,
        CubicMeterPlumbingForServiceOther: 1,
        CubicMeterPlumbingForService: 1,
        CubicMeterPlumbingForProductMWA: 1,
        CubicMeterPlumbingForProductPWA: 1,
        CubicMeterPlumbingForProductOther: 1,
        CubicMeterPlumbingForProduct: 1,
        CubicMeterPlumbingForDrinkMWA: 1,
        CubicMeterPlumbingForDrinkPWA: 1,
        CubicMeterPlumbingForDrinkOther: 1,
        CubicMeterPlumbingForDrink: 1,
        CubicMeterSurfaceForAgriculturePool: 1,
        CubicMeterSurfaceForAgricultureRiver: 1,
        CubicMeterSurfaceForAgricultureIrrigation: 1,
        CubicMeterSurfaceForAgricultureRain: 1,
        CubicMeterSurfaceForAgriculture: 1,
        CubicMeterSurfaceForServicePool: 1,
        CubicMeterSurfaceForServiceRiver: 1,
        CubicMeterSurfaceForServiceIrrigation: 1,
        CubicMeterSurfaceForServiceRain: 1,
        CubicMeterSurfaceForService: 1,
        CubicMeterSurfaceForProductPool: 1,
        CubicMeterSurfaceForProductRiver: 1,
        CubicMeterSurfaceForProductIrrigation: 1,
        CubicMeterSurfaceForProductRain: 1,
        CubicMeterSurfaceForProduct: 1,
        CubicMeterSurfaceForDrinkPool: 1,
        CubicMeterSurfaceForDrinkRiver: 1,
        CubicMeterSurfaceForDrinkIrrigation: 1,
        CubicMeterSurfaceForDrinkRain: 1,
        CubicMeterSurfaceForDrink: 1,
        CubicMeterGroundWaterForUse: 1,
        CountCommunity: 1,
        CountCommunityHasDisaster: 1,
        IsAllHouseHoldCountryside: 1,
        IsAllHouseHoldDistrict: 1,
        IsAllFactorial: 1,
        IsAllCommercial: 1,
        CubicMeterForDrink: 1,
        Duplicate: 1,
        AdjustedCubicMeterGroundWaterForAgriculture: 1,
        AdjustedCubicMeterGroundWaterForService: 1,
        AdjustedCubicMeterGroundWaterForProduct: 1,
        AdjustedCubicMeterGroundWaterForDrink: 1,
        AdjustedCubicMeterSurfaceForAgriculture: 1,
        AdjustedCubicMeterSurfaceForService: 1,
        AdjustedCubicMeterSurfaceForProduct: 1,
        AdjustedCubicMeterSurfaceForDrink: 1,
        AdjustedCubicMeterGroundWaterForUse: 1,
        Road: 1,
        IsAdditionalCom: 1,
      },
    },
    {
      $out: "NewDataProcessBKKClean",
    },
  ],
  {
    allowDiskUse: true,
  }
);
